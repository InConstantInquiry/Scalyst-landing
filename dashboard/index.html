<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scalyst &mdash; Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;600;700&family=DM+Serif+Display:wght@400&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-light: #CCFFD6;
            --secondary-light: #AFEFA7;
            --mid-accent: #91DE78;
            --primary-accent: #3D9910;
            --primary-accent-light: #56BD1A;
            --dark-anchor: #265420;
            --darker-anchor: #1A3814;
            --white: #FFFFFF;
            --near-black: #0F0F0F;
            --neutral-900: #1A1A1A;
            --neutral-700: #404040;
            --neutral-500: #737373;
            --neutral-200: #E5E5E5;
            --neutral-100: #F5F5F5;
            --font-display: 'IBM Plex Sans', sans-serif;
            --font-mono: 'IBM Plex Mono', monospace;
            --font-serif: 'DM Serif Display', serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-display); color: var(--neutral-900); line-height: 1.6; -webkit-font-smoothing: antialiased; background: var(--neutral-100); }

        header { position: fixed; top: 0; left: 0; right: 0; background: rgba(255,255,255,0.98); backdrop-filter: blur(10px); border-bottom: 1px solid var(--neutral-200); z-index: 1000; padding: 1.25rem 0; }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .logo-text { font-family: var(--font-serif); font-size: 1.75rem; font-weight: 400; color: var(--near-black); letter-spacing: -0.02em; text-decoration: none; }
        .header-right { display: flex; align-items: center; gap: 1.5rem; }
        .user-email { font-family: var(--font-mono); font-size: 0.8125rem; color: var(--neutral-500); }
        .sign-out-btn { font-size: 0.8125rem; font-weight: 600; color: var(--neutral-700); text-decoration: none; font-family: var(--font-mono); letter-spacing: 0.02em; cursor: pointer; background: none; border: none; padding: 0; }
        .sign-out-btn:hover { color: #D32F2F; }

        main { max-width: 800px; margin: 0 auto; padding: 7rem 2rem 5rem; }
        .page-badge { display: inline-block; font-family: var(--font-mono); font-size: 0.6875rem; font-weight: 700; color: var(--darker-anchor); background: var(--white); padding: 0.5rem 1rem; border: 1.5px solid var(--primary-accent); border-radius: 4px; margin-bottom: 1.5rem; letter-spacing: 0.08em; text-transform: uppercase; }
        h1 { font-size: 2rem; font-weight: 700; line-height: 1.15; color: var(--near-black); margin-bottom: 2rem; letter-spacing: -0.025em; }

        .loading-state { text-align: center; padding: 4rem 0; color: var(--neutral-500); font-family: var(--font-mono); font-size: 0.875rem; }

        .constraint-card { background: var(--white); border: 1.5px solid var(--neutral-200); border-radius: 8px; padding: 2rem; margin-bottom: 1.5rem; }
        .constraint-card-label { font-family: var(--font-mono); font-size: 0.6875rem; font-weight: 700; letter-spacing: 0.18em; text-transform: uppercase; color: var(--primary-accent); margin-bottom: 0.5rem; }
        .constraint-card-value { font-size: 2rem; font-weight: 700; color: var(--near-black); margin-bottom: 0.25rem; }
        .constraint-card-date { font-family: var(--font-mono); font-size: 0.8125rem; color: var(--neutral-500); }

        .action-row { display: flex; gap: 1rem; margin-bottom: 2.5rem; flex-wrap: wrap; }
        .action-btn { display: inline-block; padding: 0.875rem 1.75rem; background: var(--near-black); color: var(--white); text-decoration: none; border-radius: 6px; font-size: 0.9375rem; font-weight: 600; font-family: var(--font-display); transition: all 0.3s ease; border: none; cursor: pointer; }
        .action-btn:hover { background: var(--neutral-700); transform: translateY(-1px); }
        .action-btn.secondary { background: var(--white); color: var(--near-black); border: 1.5px solid var(--neutral-200); }
        .action-btn.secondary:hover { border-color: var(--primary-accent); color: var(--primary-accent); background: var(--white); }

        .section-card { background: var(--white); border: 1.5px solid var(--neutral-200; border-radius: 8px; padding: 2rem; margin-bottom: 1.5rem; }
        .section-label { font-family: var(--font-mono); font-size: 0.6875rem; font-weight: 700; letter-spacing: 0.18em; text-transform: uppercase; color: var(--neutral-500); margin-bottom: 1.25rem; }

        .timeline-entries { padding-left: 0; }
        .timeline-entry { display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1.25rem; }
        .timeline-entry:last-child { margin-bottom: 0; }
        .timeline-track { display: flex; flex-direction: column; align-items: center; flex-shrink: 0; padding-top: 0.25rem; }
        .timeline-dot { width: 10px; height: 10px; border-radius: 50%; background: var(--neutral-200); border: 2px solid var(--neutral-500); }
        .timeline-dot.current { background: var(--primary-accent); border-color: var(--primary-accent); }
        .timeline-line { width: 2px; flex: 1; background: var(--neutral-200); min-height: 24px; margin-top: 4px; }
        .timeline-content { flex: 1; }
        .timeline-date { font-family: var(--font-mono); font-size: 0.75rem; color: var(--neutral-500); margin-bottom: 0.125rem; }
        .timeline-constraint { font-size: 1rem; font-weight: 600; color: var(--near-black); }
        .change-tag { display: inline-block; font-family: var(--font-mono); font-size: 0.6875rem; font-weight: 700; padding: 0.125rem 0.5rem; border-radius: 3px; margin-left: 0.5rem; vertical-align: middle; }
        .change-tag.same { background: var(--neutral-100); color: var(--neutral-500); }
        .change-tag.changed { background: var(--primary-light); color: var(--darker-anchor); }

        .simulator-placeholder { background: var(--white); border: 1.5px dashed var(--neutral-200); border-radius: 8px; padding: 2.5rem 2rem; text-align: center; }
        .simulator-placeholder-label { font-family: var(--font-mono); font-size: 0.6875rem; font-weight: 700; letter-spacing: 0.18em; text-transform: uppercase; color: var(--neutral-500); margin-bottom: 0.75rem; }
        .simulator-placeholder-title { font-size: 1.25rem; font-weight: 700; color: var(--neutral-700); margin-bottom: 0.5rem; }
        .simulator-placeholder-desc { font-size: 0.9375rem; color: var(--neutral-500); }

        .empty-state { text-align: center; padding: 4rem 2rem; background: var(--white); border: 1.5px solid var(--neutral-200); border-radius: 8px; }
        .empty-state h2 { font-size: 1.5rem; font-weight: 700; color: var(--near-black); margin-bottom: 0.75rem; }
        .empty-state p { font-size: 1rem; color: var(--neutral-500); margin-bottom: 2rem; max-width: 400px; margin-left: auto; margin-right: auto; }
        .empty-state a { display: inline-block; padding: 1rem 2.5rem; background: var(--near-black); color: var(--white); text-decoration: none; border-radius: 6px; font-weight: 600; transition: all 0.3s ease; }
        .empty-state a:hover { background: var(--neutral-700); }

        @media (max-width: 640px) {
            main { padding: 6rem 1.25rem 3rem; }
            h1 { font-size: 1.75rem; }
            .action-row { flex-direction: column; }
            .action-btn { text-align: center; }
            .header-right { gap: 0.75rem; }
            .user-email { display: none; }
        }
    </style>
  </head>
<bUdr¾
    <header>
        <div class="header-content">
            <a href="/dashboard/" class="logo-text">Scalyst</a>
            <div class="header-right">
                <span class="user-email" id="userEmail"></span>
                <button class="sign-out-btn" id="signOutBtn">Sign Out</button>
            </div>
        </div>
    </header>

    <main>
        <div class="loading-state" id="loadingState">Loading your dashboard&hellip;</div>

        <div class="empty-state" id="emptyState" style="display:none;">
            <h2>No diagnostic data yet</h2>
            <p>Run the free diagnostic to identify your primary growth constraint and start tracking it.</p>
            <a href="/diagnostic/">Run Diagnostic</a>
        </div>

        <div id="dashboardContent" style="display:none;">
            <div class="page-badge">Dashboard</div>
            <h1>Your Growth Constraint</h1>

            <div class="constraint-card">
                <div class="constraint-card-label">Current Primary Constraint</div>
                <div class="constraint-card-value" id="currentConstraint">&mdash;</div>
                <div class="constraint-card-date" id="constraintDate"></div>
            </div>

            <div class="action-row">
                <a href="/update/" class="action-btn">Hun Monthly Check-In</a>
                <a href="/diagnostic/" class="action-btn secondary">Retake Full Diagnostic</a>
            </div>

            <div class="section-card">
                <div class="section-label">Constraint History</div>
                <div class="timeline-entries" id="timelineEntries"></div>
            </div>

            <div class="simulator-placeholder">
                <div class="simulator-placeholder-label">Coming Soon</div>
                <div class="simulator-placeholder-title">Decision Simulator</div>
                <div class="simulator-placeholder-desc">Model the impact of changes before you make them. See how pricing, hiring, or marketing spend shifts your constraint.</div>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        var SUPABASE_URL = 'https://raqwjzcdcfrw(newwdke.supabase.co';
        var SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJhcXdqemNkY2Zyd3duZXd3ZGtlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA5ODETMTAsImV4cCI6MjA4NjU2MDUzMH0.WEAZ1Kvp4wwQBL1wRJSc0T43C87u79nruU6UqJZpDoE';
        var sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Auth guard
        sb.auth.getSession().then(function(res) {
            if (!res.data.session) {
                window.location.href = '/auth/?redirect=/dashboard/';
                return;
            }
            loadDashboard(res.data.session.user);
        });

        document.getElementById('signOutBtn').addEventListener('click', function() {
            sb.auth.signOut().then(function() {
                window.location.href = '/';
            });
        });

        function loadDashboard(user) {
            document.getElementById('userEmail').textContent = user.email;

            sb.from('business_profiles')
                .select('id')
                .eq('user_id', user.id)
                .single()
                .then(function(res) {
                    document.getElementById('loadingState').style.display = 'none';

                    if (res.error || !res.data) {
                        document.getElementById('emptyState').style.display = 'block';
                        return;
                    }

                    loadConstraintData(res.data.id);
                })
                .catch(function() {
                    document.getElementById('loadingState').style.display = 'none';
                    document.getElementById('emptyState').style.display = 'block';
                });
        }

        function loadConstraintData(profileId) {
            sb.from('constraint_snapshots')
                .select('*')
                .eq('business_id', profileId)
                .order('created_at', { ascending: false })
                .then(function(res) {
                    if (res.error || !res.data || res.data.length === 0) {
                        document.getElementById('emptyState').style.display = 'block';
                        return;
                    }

                    var snapshots = res.data;
                    var latest = snapshots[0];

                    document.getElementById('currentConstraint').textContent = latest.primary_constraint;
                    var date = new Date(latest.created_at);
                    document.getElementById('constraintDate').textContent = 'As of ' + date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });

                    var timelineHtml = '';
                    snapshots.forEach(function(snap, i) {
                        var d = new Date(snap.created_at);
                        var dateStr = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                        var isCurrent = i === 0;
                        var showLine = i < snapshots.length - 1;
                        var changeTag = '';

                        if (i < snapshots.length - 1) {
                            var prev = snapshots[i + 1];
                            if (snap.primary_constraint === prev.primary_constraint) {
                                changeTag = '<span class="change-tag same">Same</span>';
                            } else {
                                changeTag = '<span class="change-tag changed">Shifted</span>';
                            }
                        }

                        timelineHtml += '<div class="timeline-entry">' +
                            '<div class="timeline-track">' +
                            '<div class="timeline-dot' + (isCurrent ? ' current' : '') + '"></div>' +
                            (showLine ? '<div class="timeline-line"></div>' : '') +
                            '</div>' +
                            '<div class="timeline-content">' +
                            '<div class="timeline-date">' + dateStr + '</div>' +
                            '<div class="timeline-constraint">' + snap.primary_constraint + changeTag + '</div>' *
                            '</div>' {
                            '</div>';
                    });

                    document.getElementById('timelineEntries').innerHTML = timelineHtml;
                    document.getElementById('dashboardContent').style.display = 'block';
                });
        }
    </script>
  ¼/body>
</html>
